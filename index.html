<!DOCTYPE html>
<html>
<head>
        
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-height, target-densitydpi=device-dpi" />
 
<title>SMART GRID by Applh.com (v1.5)</title>

   <link rel="stylesheet" href="jquery-mobile.css">

<style type="text/css">
body.applh {
background:url(applh-logo.png) repeat-x fixed center bottom #012345;
font-family:monospace;
padding:0px;
width:100%;
height:100%;
}
body.applh .page {
margin:0px auto;
overflow:hidden;
margin:0 auto;
background:none transparent;
}
table {
border-collapse:separate;
border-spacing:5px;
font-size:40px;
}
.grid td {
width:50px;
height:50px;
padding:5px;
border:2px #ffffff solid;
border-radius:12px;
}
tr.play1 td {
border:2px #00ffff solid;
}
tr.play2 td {
border:2px #ffff00 solid;
}
.player1 {
float:left;
min-width:49%;
}
.player2 {
float:right;
min-width:49%;
}
.card1 {
   color:#ffffff;
}
.card2 {
   color:#ffffff;
}
.texto1 {
text-align:center;
}

.menu1 {
color:#eeeeee;
text-align:center;
}
.menu2 {
color:#eeeeee;
text-align:center;
margin-bottom:40px;
}

.player1 .hand {
margin-bottom:0px;
}
.player2 .hand {
margin-bottom:0px;
}

.hand1 {
float:left;
margin-top:5px;
}
.hand2 {
float:right;
margin-top:5px;
}

.hand1 .cards {
background-color:#00FFFF;
padding:10px;
color:transparent;
text-shadow:none;
border:2px solid #123456;
border-radius:20px;
margin-top:0px;
margin-bottom:0px;
}


.hand2 .cards {
background-color:#FFFF00;
padding:10px;
color:transparent;
text-shadow:none;
border:2px solid #654321;
border-radius:20px;
margin-top:10px;
margin-bottom:0px;
}


.card-on {
margin:0 auto;
font-size:60px;
text-align:center;
margin-top:0px;
padding:2px;
color:#FFFFFF;
}
.card-on1 {
border:2px solid #00FFFF;
width:90px;
height:90px;
border-radius:10px;
margin:0 auto;
color:#FFFFFF;
}
.card-on2 {
border:2px solid #FFFF00;
width:90px;
height:90px;
margin:0 auto;
border-radius:10px;
color:#FFFFFF;
}

.hand1 .show {
color:#000000;
}
.hand2 .show {
color:#000000;
}


</style>

   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="jquery-mobile.js"></script>

   <script type="text/javascript" src="phonegap.js"></script>
 
<script>
var BB={};

BB.media2sound=[];

BB.media2success=function() {
};

BB.media2error=function(error) {
};

// Cordova is ready
BB.device2ready=function() {
   BB.media2sound["ace"] = new Media("media/ace-opens-four-cards-challenge.mp3", BB.media2success, BB.media2error);
   BB.media2sound["king"] = new Media("media/king-opens-three-cards-challenge.mp3", BB.media2success, BB.media2error);
   BB.media2sound["queen"] = new Media("media/queen-opens-two-cards-challenge.mp3", BB.media2success, BB.media2error);
   BB.media2sound["jack"] = new Media("media/jack-opens-one-card-challenge.mp3", BB.media2success, BB.media2error);
   BB.media2sound["ten"] = new Media("media/ten.mp3", BB.media2success, BB.media2error);
   BB.media2sound["nine"] = new Media("media/nine.mp3", BB.media2success, BB.media2error);
   BB.media2sound["eight"] = new Media("media/eight.mp3", BB.media2success, BB.media2error);
   BB.media2sound["seven"] = new Media("media/seven.mp3", BB.media2success, BB.media2error);
   BB.media2sound["six"] = new Media("media/six.mp3", BB.media2success, BB.media2error);
   BB.media2sound["five"] = new Media("media/five.mp3", BB.media2success, BB.media2error);
   BB.media2sound["four"] = new Media("media/four.mp3", BB.media2success, BB.media2error);
   BB.media2sound["three"] = new Media("media/three.mp3", BB.media2success, BB.media2error);
   BB.media2sound["two"] = new Media("media/two.mp3", BB.media2success, BB.media2error);
   BB.media2sound["battle"] = new Media("media/battle-battle.mp3", BB.media2success, BB.media2error);
   BB.media2sound["player-one"] = new Media("media/player-one.mp3", BB.media2success, BB.media2error);
   BB.media2sound["player-two"] = new Media("media/player-two.mp3", BB.media2success, BB.media2error);
   BB.media2sound["player-one-wins"] = new Media("media/player-one-wins.mp3", BB.media2success, BB.media2error);
   BB.media2sound["player-two-wins"] = new Media("media/player-two-wins.mp3", BB.media2success, BB.media2error);
   
};

BB.media2playing=null;

BB.media2play=function (sound) {
   if (sound && (BB.media2sound[sound] != null)) {
      if (BB.media2playing != null) {
         BB.media2playing.stop();
      }
      BB.media2sound[sound].play();
      BB.media2playing=BB.media2sound[sound];
   }
};

// Wait for Cordova to load
document.addEventListener("deviceready", BB.device2ready, false);


</script>
</head>
<body class="applh">
<div class="page" data-role="page">
 <div class="container" style="clear:both;">
  <div class="gameboard" style="margin:0 auto;max-width:990px;font-family:monospace;background-color:transparent;">
<div style="clear:both;padding:0;"> 
 <div class="player1" style="background:url(cards_blue_120.png) no-repeat scroll center 10px #00AAFF;margin:0 auto;min-height:70px;">
 </div>
 <div class="player2" style="background:url(cards_red_120.png) no-repeat scroll center 10px #FFAA00;margin:0 auto;min-height:70px;">
 </div>
</div>     
<div class="texto1" style="height:25px;background-color:#dddddd;margin:0 auto;color:#123456;font-size:16px;clear:both;padding:5px;border-bottom-right-radius:50px;border-bottom-left-radius:50px;">
 </div>
<div class="game-cards">
  <p class="hand1"><span class="cards"></span></p>
  <p class="hand2"><span class="cards"></span></p>
</div>

<table style="width:100%;padding:0;">
 <tbody>
<tr>
 <td>
  <table class="grid grid1" style="width:300px;margin:5px;float:left;color:#012345;">
 <tbody>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
  </tbody>
</table>
 </td>
 <td>
 <div style="padding-top:10px;padding-right:10px;overflow:hidden;height:480px;min-width:250px;border:2px solid #22ff22;border-radius:20px;margin:0 auto;">
   <div class="menu" style="height:50px;font-size:16px;text-align:center;margin-top:0px;">
   <span class="menu1">MENU</span>
   </div>
   <div class="menu2" style="display:none;height:60px;font-size:16px;text-align:center;margin-top:0px;">
    <hr/>
    <div class="act_restart">RESTART GAME</div> 
    <hr/>
    <div class="act_toggle_cards">Show/Hide Cards</div> 
    <hr/>
   </div>
   <div class="card1 card-on" style="">
   </div>
   <div class="card2 card-on" style="">
   </div>
   <div class="card3 card-on" style="">
   </div>
   <div class="card4 card-on" style="">
   </div>
   <div class="card5 card-on" style="">
   </div>
    </div>
 </div>
 </td>
 <td>
<table class="grid grid2" style="width:300px;margin:5px;float:right;color:#012345;">
 <tbody>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
  </tbody>
  </table>
  </td>
</tr>
 </tbody>
</table>

</div>
<script type="text/javascript">
var PlayCB={};
PlayCB.cards=[
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
];

PlayCB.shuffle = function(o){ 
    for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    return o;
};
PlayCB.cards0=[
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
];

PlayCB.cardsX=[];

PlayCB.click1=0;
PlayCB.card1=0;
PlayCB.card11=0;
PlayCB.color1='#00aaff';

PlayCB.click2=0;
PlayCB.card2=0;
PlayCB.card22=0;
PlayCB.color2='#ffaa00';

PlayCB.curmode='play';
PlayCB.curplay=1;

PlayCB.act_show1=function() {
   PlayCB.card11=PlayCB.card1;
   PlayCB.card1=PlayCB.cards1.pop();
   jQuery(".hand1 .cards").html(PlayCB.cards1.join());
 //  jQuery('.card1').html(PlayCB.card1);
   jQuery('.card-on:last').html('<div class="card-on1">'+PlayCB.card1+'</div>').detach().insertBefore('.card-on:first');
};
PlayCB.act_show2=function() {
   PlayCB.card22=PlayCB.card2;
   PlayCB.card2=PlayCB.cards2.pop();
   jQuery(".hand2 .cards").html(PlayCB.cards2.join());
//   jQuery('.card2').html(PlayCB.card2);
   jQuery('.card-on:last').html('<div class="card-on2">'+PlayCB.card2+'</div>').detach().insertBefore('.card-on:first');
};

PlayCB.check_fight=function() {
   res = false;
   curXl=PlayCB.cardsX.length;   
   if (curXl >1) {
      res = (PlayCB.cardsX[curXl-1] == PlayCB.cardsX[curXl-2]);
   }
   if (!res) {
      if (curXl >2) {
         res = (PlayCB.cardsX[curXl-1] == PlayCB.cardsX[curXl-3]);
      }
   }
   return res;
}

PlayCB.start_chain=0;
PlayCB.start_card='';
PlayCB.end_turn=false;

PlayCB.change_player=function() {
   PlayCB.end_turn=false;
   
   res = false;
   curXl=PlayCB.cardsX.length;   
   
   if (!res) {
      if (curXl >0) {
         lastX = PlayCB.cardsX[curXl-1];
         res = (lastX == 'J') 
               || (lastX == 'Q') 
               || (lastX == 'K') 
               || (lastX == 'A');
               
         if (res) { 
            PlayCB.start_chain=curXl;
            PlayCB.start_card=lastX;
         }

         if (lastX == 'J') {
            BB.media2play("jack");
         }
         else if (lastX == 'Q') {
            BB.media2play("queen");
         }
         else if (lastX == 'K') {
            BB.media2play("king");
         }
         else if (lastX == 'A') {
            BB.media2play("ace");
         }
      }
   }
   
   if (curXl == 1) res=true;
   
   if (!res) {
      if (curXl >1) {
         if (PlayCB.cardsX[curXl-2] == 'J') {
            PlayCB.end_turn=true;
            res = true; 
         }
      }
   }

   if (!res) {
      if (curXl >2) {
         var deltaX=curXl - PlayCB.start_chain;

         if ((deltaX > 1) && (PlayCB.start_card == 'Q')) {
            PlayCB.end_turn=true;
            res = true;          
         }
         if ((deltaX > 2) && (PlayCB.start_card == 'K')) {
            PlayCB.end_turn=true;
            res = true;          
         }
         if ((deltaX > 3) && (PlayCB.start_card == 'A')) {
            PlayCB.end_turn=true;
            res = true;          
         }

      }
   }
   return res;
}


PlayCB.fstart=0;
PlayCB.fend=0;

PlayCB.check=function(){

   is_fight=PlayCB.check_fight();

   if (is_fight) {
      PlayCB.curmode='battle';
      PlayCB.winner=0;
      
      PlayCB.target1=Math.floor(28 * Math.random());
      PlayCB.target2=Math.floor(28 * Math.random());
      jQuery(".grid1 td:eq("+PlayCB.target1+")")
         .html("#")
         .css("background-color", "#00ff00"); 
      jQuery(".grid2 td:eq("+PlayCB.target2+")")
         .html("#")
         .css("background-color", "#00ff00"); 

      var d = new Date();
      PlayCB.fstart = d.getTime();

      BB.media2play("battle");
   }
   else {
      var change_turn=PlayCB.change_player();
      if (PlayCB.end_turn) {
         PlayCB.curmode='battle';
         if (PlayCB.curplay == 1) {
            PlayCB.winner = 2;
         }
         else if (PlayCB.curplay == 2) {
            PlayCB.winner = 1;
         }
         PlayCB.check_winner();
      }
      else if (change_turn || (PlayCB.start_chain == 0)) {
         if (PlayCB.curplay == 1) {
            PlayCB.curplay = 2;
         }
         else if (PlayCB.curplay == 2) {
            PlayCB.curplay = 1;
         }
      }

   }
   
   if (PlayCB.cards1.length == 0) {
      //alert("PLAYER 2 WINS");
      PlayCB.texto='* PLAYER 2 WINS * (click to restart)';
      PlayCB.message();
      PlayCB.curmode='end';

      BB.media2play("player-one-wins");
   }
   if (PlayCB.cards2.length == 0) {
      //alert("PLAYER 1 WINS");
      PlayCB.texto='* PLAYER 1 WINS * (click to restart)';
      PlayCB.message();
      PlayCB.curmode='end';

      BB.media2play("player-two-wins");
   }
};


PlayCB.reset_turn=function(){
      PlayCB.start_chain=0;
      PlayCB.start_card='';
      PlayCB.cardsX=[];
      // RESET GRID
      jQuery(".grid td")
         .empty()
         .css("background-color", "#eeeeee");
              
      PlayCB.card1='';
      PlayCB.card11='';
      jQuery(".hand1 .cards").html(PlayCB.cards1.join());

      PlayCB.card2='';
      PlayCB.card22='';
      jQuery(".hand2 .cards").html(PlayCB.cards2.join());

   if (PlayCB.winner == 1) {     
      jQuery('.card-on:last').html('<span style="color:#00FFFF;">*'+PlayCB.winner+'*</span>').detach().insertBefore('.card-on:first');
      BB.media2play("player-one");
   }
   else if (PlayCB.winner == 2) {     
      jQuery('.card-on:last').html('<span style="color:#FFFF00;">*'+PlayCB.winner+'*</span>').detach().insertBefore('.card-on:first');
      BB.media2play("player-two");
   }


};

PlayCB.texto='';
PlayCB.check_winner=function(){
   if (PlayCB.curmode == 'battle') {
      
      var textdelay = '';
      if (PlayCB.fstart > 0) {
         var d = new Date();
         PlayCB.fend = d.getTime();
         var fdelay = PlayCB.fend - PlayCB.fstart;
         textdelay = ' * ' + fdelay + 'ms';

         PlayCB.fstart = 0;
         PlayCB.fend = 0;
      }

      //alert("WINNER [" + PlayCB.winner + "]\n"+ PlayCB.cardsX.join());
      var ts = PlayCB.click1 + PlayCB.click2;
      PlayCB.texto = '#'+ ts + textdelay + ' * Player ' + PlayCB.winner + " WINS "+ PlayCB.cardsX.join() + '';
      
      if (PlayCB.winner == 1) {
         PlayCB.cardsX.reverse();
         PlayCB.cards1=PlayCB.cardsX.concat(PlayCB.cards1);
         PlayCB.curplay=1;
      }
      else if (PlayCB.winner == 2) {
         PlayCB.cardsX.reverse();
         PlayCB.cards2=PlayCB.cardsX.concat(PlayCB.cards2);
         PlayCB.curplay=2;
      }     

      PlayCB.reset_turn();
      PlayCB.message();
   }
};

PlayCB.message=function() {
      PlayCB.curmode='wait';
      jQuery(".texto1, .texto2")
                .empty()
                .html(PlayCB.texto);
      // FIXME: NOT WORKING with iOS        
      //jQuery(".texto1 .msg, .texto2 .msg").fadeOut( 1000 );
      PlayCB.curmode='play';

};

PlayCB.act_click1=function(event){
   event.preventDefault();

  if (PlayCB.curmode=='end') {
     PlayCB.reset_game();
     return;
  }
  
  curt=jQuery(this).html()
  if (PlayCB.curmode=='battle') {
    if (curt == "#") {
       PlayCB.winner=1;
       PlayCB.check_winner();
    }
  }
  
  if (PlayCB.curmode=='play') {
    if (curt != "") return;
    if (PlayCB.curplay != 1) return;
  
    PlayCB.click1++;
    //jQuery(".player1").html(PlayCB.click1);

    if (PlayCB.cards1.length > 0) {
     PlayCB.act_show1();
     jQuery(this)
        .html(PlayCB.card1)
        .css("background-color", PlayCB.color1);
     PlayCB.cardsX.push(PlayCB.card1);
    }
    PlayCB.check();
  }
};

PlayCB.act_click2=function(event){
   event.preventDefault();
  if (PlayCB.curmode=='end') {
     PlayCB.reset_game();
     return;
  }

  curt=jQuery(this).html()
  if (PlayCB.curmode=='battle') {
    if (curt == "#") {
       PlayCB.winner=2;
       PlayCB.check_winner();
    }
  }
  if (PlayCB.curmode=='play') {
    if (curt != "") return;
    if (PlayCB.curplay != 2) return;

    PlayCB.click2++;
    //jQuery(".player2").html(PlayCB.click2);

    if (PlayCB.cards2.length > 0) {
     PlayCB.act_show2();
     jQuery(this)
        .html(PlayCB.card2)
        .css("background-color", PlayCB.color2);
     PlayCB.cardsX.push(PlayCB.card2);
    }
    PlayCB.check();
  }
};

PlayCB.winner=null;
PlayCB.reset_game=function() {

   PlayCB.texto='* BATTLE CARDS / v1.5 / by Applh.com *';
   PlayCB.message();
  
   PlayCB.click1=0;
   PlayCB.click2=0;
   
   PlayCB.shuffle(PlayCB.cards0);
   PlayCB.nc1=Math.round(PlayCB.cards0.length / 2);

   PlayCB.cards1=PlayCB.cards0.slice(0, PlayCB.nc1);
   PlayCB.cards2=PlayCB.cards0.slice(PlayCB.nc1);

   PlayCB.reset_turn();

   jQuery(".menu2").hide();
   jQuery(".card-on").html("");

   if (PlayCB.winner) {
      jQuery('.card-on:last').html('WINS').detach().insertBefore('.card-on:first');

      if (PlayCB.winner == 1) {     
         jQuery('.card-on:last').html('<span style="color:#00FFFF;">*'+PlayCB.winner+'*</span>').detach().insertBefore('.card-on:first');
      }
      else if (PlayCB.winner == 2) {     
         jQuery('.card-on:last').html('<span style="color:#FFFF00;">*'+PlayCB.winner+'*</span>').detach().insertBefore('.card-on:first');
      }

      jQuery('.card-on:last').html('PLAYER').detach().insertBefore('.card-on:first');
   }
   else {
      jQuery('.card-on:last').html('CARDS').detach().insertBefore('.card-on:first');
      jQuery('.card-on:last').html('BATTLE').detach().insertBefore('.card-on:first');
      jQuery('.card-on:last').html('<span style="color:#00FFFF;">*1*</span>').detach().insertBefore('.card-on:first');
   }

   PlayCB.curplay=1;
   PlayCB.curmode='play';

};

PlayCB.act_menu1=function() {
   jQuery(".menu2").slideToggle(500);
}
PlayCB.act_restart=function() {
   PlayCB.winner = null;
   PlayCB.reset_game();
}

PlayCB.act_toggle_cards=function(){
   jQuery(".hand1 .cards, .hand2 .cards").toggleClass("show");
}

PlayCB.init=function() {
   PlayCB.reset_game();
   
   jQuery(".play1 td").tap(PlayCB.act_click1);
   jQuery(".play2 td").tap(PlayCB.act_click2);
   jQuery(".menu1").tap(PlayCB.act_menu1);
   jQuery(".act_restart").tap(PlayCB.act_restart);
   jQuery(".act_toggle_cards").tap(PlayCB.act_toggle_cards);
};

jQuery(PlayCB.init);

</script>
</div>  
</body>
</html>
