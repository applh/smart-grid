<!DOCTYPE html>
<html>
<head>
        
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="format-detection" content="telephone=no" />
<meta name="viewport" content="user-scalable=yes, initial-scale=1, maximum-scale=2, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
 
<title>SMART GRID by Applh.com</title>
<style type="text/css">
body {
background-color:#012345;
font-family:monospace;
padding:0px;
margin:0px;
}
table {
border-collapse:separate;
border-spacing:5px;
font-size:40px;
}
.grid td {
width:50px;
height:50px;
padding:5px;
border:1px #ffffff solid;
border-radius:10px;
}
tr.play1 td {
border:1px #00ffff solid;
}
tr.play2 td {
border:1px #ffff00 solid;
}
.player1 {
text-align:center;
}
.player2 {
text-align:center;
}
.card1 {
   color:#ffffff;
}
.card2 {
   color:#ffffff;
}
.menu1 {
color:#eeeeee;
text-align:center;
}
</style>
<script type="text/javascript" src="jquery190min.js"></script>
</head>
<body>
<div style="font-family:monospace;background-color:#012345;">

<div class="player1" style="width:900px;height:40px;background:url(cards_blue_120.png) no-repeat scroll 5px 5px #00AAFF;margin:0 auto;color:#123456;font-size:8px;clear:both;padding:10px;">
 </div>
<div class="texto1" style="width:900px;height:25px;background-color:#dddddd;margin:0 auto;color:#123456;font-size:20px;clear:both;padding:10px;">
 </div>

<div style="width:900px;margin:0 auto;clear:both;">
  <table class="grid" style="width:700px;margin:5px;float:left;color:#012345;">
 <tbody>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play1">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
<tr class="play2">
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
 <td></td>
</tr>
 </tbody>
  </table>
  <div style="float:right;padding-top:10px;padding-right:10px;overflow:hidden;height:400px;">
   <div class="menu" style="width:160px;height:50px;font-size:16px;text-align:center;margin-top:0px;">
   <span class="menu1">MENU</span>
   </div>
   <div class="menu2" style="display:none;width:140px;height:80px;font-size:16px;text-align:center;margin-top:0px;">
    <hr/>
    <div class="act_restart">RESTART GAME</div> 
    <hr/>
   </div>
   <div class="card1" style="width:160px;height:120px;font-size:100px;text-align:center;margin-top:30px;">
   </div>
   <div class="card2" style="width:160px;height:120px;font-size:100px;text-align:center;margin-top:30px;">
   </div>
  </div>
 </div>

 <div class="texto2" style="width:900px;height:25px;background-color:#dddddd;margin:0 auto;color:#123456;font-size:20px;clear:both;padding:10px;">
 </div>
 
 <div class="player2" style="width:900px;height:40px;background:url(cards_red_120.png) no-repeat scroll 5px 5px #FFAA00;margin:0 auto;color:#123456;font-size:8px;clear:both;padding:10px;">
 </div>
        
</div>
<script type="text/javascript">
var PlayCB={};
PlayCB.cards=[
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
];

PlayCB.shuffle = function(o){ 
    for(var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
    return o;
};
PlayCB.cards0=[
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
'A','2','3','4','5','6','7','8','9','10','J','Q','K',
];

PlayCB.cardsX=[];

PlayCB.click1=0;
PlayCB.card1=0;
PlayCB.card11=0;
PlayCB.color1='#00aaff';

PlayCB.click2=0;
PlayCB.card2=0;
PlayCB.card22=0;
PlayCB.color2='#ffaa00';

PlayCB.curmode='play';
PlayCB.curplay=1;

PlayCB.act_show1=function() {
   PlayCB.card11=PlayCB.card1;
   PlayCB.card1=PlayCB.cards1.pop();
   jQuery(".player1").html(PlayCB.cards1.join());
   jQuery('.card1').html(PlayCB.card1);
};
PlayCB.act_show2=function() {
   PlayCB.card22=PlayCB.card2;
   PlayCB.card2=PlayCB.cards2.pop();
   jQuery(".player2").html(PlayCB.cards2.join());
   jQuery('.card2').html(PlayCB.card2);
};

PlayCB.check_fight=function() {
   res = false;
   curXl=PlayCB.cardsX.length;   
   if (curXl >1) {
      res = (PlayCB.cardsX[curXl-1] == PlayCB.cardsX[curXl-2]);
   }
   if (!res) {
      if (curXl >2) {
         res = (PlayCB.cardsX[curXl-1] == PlayCB.cardsX[curXl-3]);
      }
   }
   return res;
}

PlayCB.start_chain=0;
PlayCB.start_card='';
PlayCB.end_turn=false;

PlayCB.change_player=function() {
   PlayCB.end_turn=false;
   
   res = false;
   curXl=PlayCB.cardsX.length;   
   
   if (!res) {
      if (curXl >0) {
         lastX = PlayCB.cardsX[curXl-1];
         res = (lastX == 'J') 
               || (lastX == 'Q') 
               || (lastX == 'K') 
               || (lastX == 'A');
               
         if (res) { 
            PlayCB.start_chain=curXl;
            PlayCB.start_card=lastX;
         }
      }
   }
   
   if (curXl == 1) res=true;
   
   if (!res) {
      if (curXl >1) {
         if (PlayCB.cardsX[curXl-2] == 'J') {
            PlayCB.end_turn=true;
            res = true; 
         }
      }
   }

   if (!res) {
      if (curXl >2) {
         var deltaX=curXl - PlayCB.start_chain;

         if ((deltaX > 1) && (PlayCB.start_card == 'Q')) {
            PlayCB.end_turn=true;
            res = true;          
         }
         if ((deltaX > 2) && (PlayCB.start_card == 'K')) {
            PlayCB.end_turn=true;
            res = true;          
         }
         if ((deltaX > 3) && (PlayCB.start_card == 'A')) {
            PlayCB.end_turn=true;
            res = true;          
         }

      }
   }
   return res;
}


PlayCB.fstart=0;
PlayCB.fend=0;

PlayCB.check=function(){

   is_fight=PlayCB.check_fight();

   if (is_fight) {
      PlayCB.curmode='battle';
      PlayCB.winner=0;
      
      PlayCB.target1=Math.floor(30 * Math.random());
      PlayCB.target2=Math.floor(30 * Math.random()) + 30;
      jQuery(".grid td:eq("+PlayCB.target1+")")
         .html("#")
         .css("background-color", "#00ff00"); 
      jQuery(".grid td:eq("+PlayCB.target2+")")
         .html("#")
         .css("background-color", "#00ff00"); 

      var d = new Date();
      PlayCB.fstart = d.getTime();
   }
   else {
      var change_turn=PlayCB.change_player();
      if (PlayCB.end_turn) {
         PlayCB.curmode='battle';
         if (PlayCB.curplay == 1) {
            PlayCB.winner = 2;
         }
         else if (PlayCB.curplay == 2) {
            PlayCB.winner = 1;
         }
         PlayCB.check_winner();
      }
      else if (change_turn || (PlayCB.start_chain == 0)) {
         if (PlayCB.curplay == 1) {
            PlayCB.curplay = 2;
         }
         else if (PlayCB.curplay == 2) {
            PlayCB.curplay = 1;
         }
      }

   }
   
   if (PlayCB.cards1.length == 0) {
      //alert("PLAYER 2 WINS");
      PlayCB.texto='* PLAYER 2 WINS * (click to restart)';
      PlayCB.message();
      PlayCB.curmode='end';
   }
   if (PlayCB.cards2.length == 0) {
      //alert("PLAYER 1 WINS");
      PlayCB.texto='* PLAYER 1 WINS * (click to restart)';
      PlayCB.message();
      PlayCB.curmode='end';
   }
};


PlayCB.reset_turn=function(){
      PlayCB.start_chain=0;
      PlayCB.start_card='';
      PlayCB.cardsX=[];
      // RESET GRID
      jQuery(".grid td")
         .empty()
         .css("background-color", "#eeeeee");
              
      PlayCB.card1='';
      PlayCB.card11='';
      jQuery(".player1").html(PlayCB.cards1.join());
      jQuery('.card1').html(PlayCB.card1);

      PlayCB.card2='';
      PlayCB.card22='';
      jQuery(".player2").html(PlayCB.cards2.join());
      jQuery('.card2').html(PlayCB.card2);
        
};

PlayCB.texto='';
PlayCB.check_winner=function(){
   if (PlayCB.curmode == 'battle') {
      
      var textdelay = '';
      if (PlayCB.fstart > 0) {
         var d = new Date();
         PlayCB.fend = d.getTime();
         var fdelay = PlayCB.fend - PlayCB.fstart;
         textdelay = ' * ' + fdelay + 'ms';

         PlayCB.fstart = 0;
         PlayCB.fend = 0;
      }

      //alert("WINNER [" + PlayCB.winner + "]\n"+ PlayCB.cardsX.join());
      var ts = PlayCB.click1 + PlayCB.click2;
      PlayCB.texto = '#'+ ts + textdelay + ' * Player ' + PlayCB.winner + " WINS "+ PlayCB.cardsX.join() + '';
      
      if (PlayCB.winner == 1) {
         PlayCB.cardsX.reverse();
         PlayCB.cards1=PlayCB.cardsX.concat(PlayCB.cards1);
         PlayCB.curplay=1;
      }
      else if (PlayCB.winner == 2) {
         PlayCB.cardsX.reverse();
         PlayCB.cards2=PlayCB.cardsX.concat(PlayCB.cards2);
         PlayCB.curplay=2;
      }     

      PlayCB.reset_turn();
      PlayCB.message();
   }
};

PlayCB.message=function() {
      PlayCB.curmode='wait';
      jQuery(".texto1, .texto2")
                .empty()
                .html(PlayCB.texto);
      // FIXME: NOT WORKING with iOS        
      //jQuery(".texto1 .msg, .texto2 .msg").fadeOut( 1000 );
      PlayCB.curmode='play';

};

PlayCB.act_click1=function(){

  if (PlayCB.curmode=='end') {
     PlayCB.reset_game();
     return;
  }
  
  curt=jQuery(this).html()
  if (PlayCB.curmode=='battle') {
    if (curt == "#") {
       PlayCB.winner=1;
       PlayCB.check_winner();
    }
  }
  
  if (PlayCB.curmode=='play') {
    if (curt != "") return;
    if (PlayCB.curplay != 1) return;
  
    PlayCB.click1++;
    //jQuery(".player1").html(PlayCB.click1);

    if (PlayCB.cards1.length > 0) {
     PlayCB.act_show1();
     jQuery(this)
        .html(PlayCB.card1)
        .css("background-color", PlayCB.color1);
     PlayCB.cardsX.push(PlayCB.card1);
    }
    PlayCB.check();
  }
};

PlayCB.act_click2=function(){
  if (PlayCB.curmode=='end') {
     PlayCB.reset_game();
     return;
  }

  curt=jQuery(this).html()
  if (PlayCB.curmode=='battle') {
    if (curt == "#") {
       PlayCB.winner=2;
       PlayCB.check_winner();
    }
  }
  if (PlayCB.curmode=='play') {
    if (curt != "") return;
    if (PlayCB.curplay != 2) return;

    PlayCB.click2++;
    //jQuery(".player2").html(PlayCB.click2);

    if (PlayCB.cards2.length > 0) {
     PlayCB.act_show2();
     jQuery(this)
        .html(PlayCB.card2)
        .css("background-color", PlayCB.color2);
     PlayCB.cardsX.push(PlayCB.card2);
    }
    PlayCB.check();
  }
};

PlayCB.reset_game=function() {

   PlayCB.texto='BATTLE CARDS by Applh.com (v1.1)';
   PlayCB.message();
  
   PlayCB.click1=0;
   PlayCB.click2=0;
   
   PlayCB.shuffle(PlayCB.cards0);
   PlayCB.nc1=Math.round(PlayCB.cards0.length / 2);

   PlayCB.cards1=PlayCB.cards0.slice(0, PlayCB.nc1);
   PlayCB.cards2=PlayCB.cards0.slice(PlayCB.nc1);

   PlayCB.reset_turn();

   jQuery(".menu2").hide();

   PlayCB.curplay=1;
   PlayCB.curmode='play';

};

PlayCB.act_menu1=function() {
   jQuery(".menu2").toggle();
}
PlayCB.act_restart=function() {
   PlayCB.reset_game();
}
PlayCB.init=function() {
   PlayCB.reset_game();
   
   jQuery(".play1 td").click(PlayCB.act_click1);
   jQuery(".play2 td").click(PlayCB.act_click2);
   jQuery(".menu1").click(PlayCB.act_menu1);
   jQuery(".act_restart").click(PlayCB.act_restart);
};

jQuery(PlayCB.init);

</script>
  
</body>
</html>
